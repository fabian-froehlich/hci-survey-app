<!DOCTYPE html><html><head>
  <title>iron-form</title>

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <script src="../../test-fixture/test-fixture-mocha.js"></script>

  <link rel="import" href="../../polymer/polymer.html">
  <link rel="import" href="../../test-fixture/test-fixture.html">
  <link rel="import" href="../iron-form.html">
  <link rel="import" href="simple-element.html">

</head>
<body>

  <test-fixture id="Basic">
    <template>
      <form is="iron-form">
        <simple-element name="zig" value="zag"></simple-element>
        <input name="foo" value="bar">
      </form>
    </template>
  </test-fixture>

  <test-fixture id="Dupes">
    <template>
      <form is="iron-form">
        <input name="foo" value="bar">
        <input name="foo" value="barbar">
        <simple-element name="zig" value="zig"></simple-element>
        <simple-element name="zig" value="zag"></simple-element>
        <simple-element name="zig" value="zug"></simple-element>
      </form>
    </template>
  </test-fixture>

  <test-fixture id="CheckedStates">
    <template>
      <form is="iron-form">
        <input type="checkbox" name="foo" value="bar1" checked="">
        <input type="checkbox" name="foo" value="bar2">
        <input type="checkbox" name="foo" value="bar3" checked="">
        <input type="checkbox" name="foo" value="bar4">
      </form>
    </template>
  </test-fixture>

  <test-fixture id="FormGet">
    <template>
      <form is="iron-form" action="/responds_with_json" method="get">
        <simple-element name="zig" value="zag"></simple-element>
      </form>
    </template>
  </test-fixture>

  <test-fixture id="FormPost">
    <template>
      <form is="iron-form" action="/responds_with_json" method="post">
        <simple-element name="zig" value="zag"></simple-element>
      </form>
    </template>
  </test-fixture>

  <script>suite("serializing",function(){test("serializes both custom and native elements",function(){f=fixture("Basic"),assert.equal(f._customElements.length,1),assert.equal(f.elements.length,1);var e=f.serialize();assert.equal(Object.keys(e).length,2),assert.equal(e.zig,"zag"),assert.equal(e.foo,"bar")}),test("serializes elements with duplicate names",function(){f=fixture("Dupes"),assert.equal(f._customElements.length,3),assert.equal(f.elements.length,2);var e=f.serialize();assert.equal(Object.keys(e).length,2),assert.equal(e.foo.length,2),assert.equal(e.foo[0],"bar"),assert.equal(e.foo[1],"barbar"),assert.equal(e.zig.length,3),assert.equal(e.zig[0],"zig"),assert.equal(e.zig[1],"zag"),assert.equal(e.zig[2],"zug")}),test("serializes elements with checked states",function(){f=fixture("CheckedStates"),assert.equal(f._customElements.length,0),assert.equal(f.elements.length,4);var e=f.serialize();assert.equal(Object.keys(e).length,1),assert.equal(e.foo.length,2),assert.equal(e.foo[0],"bar1"),assert.equal(e.foo[1],"bar3")})}),suite("submitting",function(){var e,t;setup(function(){e=sinon.fakeServer.create(),e.respondWith("GET",/\/responds_with_json.*/,[200,'{"Content-Type":"application/json"}','{"success":true}']),e.respondWith("POST",/\/responds_with_json.*/,[200,'{"Content-Type":"application/json"}','{"success":true}']),e.respondWith("GET",/\/responds_with_error.*/,[404,'{"Content-Type":"application/text"}','{"success":false}'])}),teardown(function(){e.restore()}),test("can submit with method=get",function(s){t=fixture("FormGet");var n=!1;t.addEventListener("iron-form-submit",function(){n=!0}),t.addEventListener("iron-form-response",function(e){expect(n).to.be.equal(!0);var t=e.detail;expect(t).to.be.ok,expect(t).to.be.an("object"),expect(t.success).to.be.equal(!0),s()}),t.submit(),e.respond()}),test("can submit with method=post",function(s){t=fixture("FormPost");var n=!1;t.addEventListener("iron-form-submit",function(){n=!0}),t.addEventListener("iron-form-response",function(e){expect(n).to.be.equal(!0);var t=e.detail;expect(t).to.be.ok,expect(t).to.be.an("object"),expect(t.success).to.be.equal(!0),s()}),t.submit(),e.respond()}),test("can relay errors",function(s){t=fixture("FormPost"),t.action="/responds_with_error",t.addEventListener("iron-form-error",function(e){var t=e.detail;expect(t).to.be.ok,expect(t).to.be.an("object"),expect(t.error).to.be.ok,s()}),t.submit(),e.respond()})});</script>



</body></html>