<link rel="import" href="../../bower_components/polymer/polymer.html">
<!-- PAPER ELEMENTS -->
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-behaviors/paper-button-behavior.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-behaviors/paper-checked-element-behavior.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">

<dom-module id="survey-question">
    <template>
        <style>
            :host {
                display: block;
            }
            
            paper-checkbox {
                --paper-checkbox-size: 30px;
            }
            
            paper-radio-button {
                --paper-radio-button-size: 30px;
            }
            
            paper-radio-group {
                --paper-radio-group-item-padding: 0px;
            }
        </style>
        <div class="question">Frage [[plusOne(question-number)]]: [[question]]</div>
        <template is="dom-if" if="[[_isCheckQuestion]]">
            <template is="dom-repeat" items="[[answers]]">
                <p>
                    <paper-checkbox on-tap="timestampHandler" data-args$="[[question-number]], [[item]], [[mode]]">[[item]]</paper-checkbox>
                </p>
            </template>
        </template>
        <template is="dom-if" if="[[_isRadioQuestion]]">
            <paper-radio-group>
                <br>
                <template is="dom-repeat" items="[[answers]]">
                    <paper-radio-button name="[[item]]" on-tap="timestampHandler" data-args$="[[question-number]], [[item]], [[mode]]">[[item]]</paper-radio-button>
                    <br>
                    <br>
                </template>
            </paper-radio-group>
        </template>
    </template>

    <script>
        Polymer({

            is: 'survey-question',

            properties: {
                'question-number': {
                    type: String
                , }
                , question: {
                    type: String
                , }
                , qnr: {
                    type: Number
                , }
                , mode: {
                    type: String
                , }
                , answers: {
                    type: Array
                , }
                , data: Object
                , _isCheckQuestion: {
                    computed: '_computeIsCheckQuestion(mode)'
                , }
                , _isRadioQuestion: {
                    computed: '_computeIsRadioQuestion(mode)'
                , }


            }, //Increment+1 function for starting visual question count with 1
            plusOne: function (index) {
                return index + 1;
            }, //Boolean functions for dom-if statements
            _computeIsCheckQuestion: function (mode) {
                return mode == 'check'
            }
            , _computeIsRadioQuestion: function (mode) {
                return mode == 'radio'
            }, // Handler for receiving timestamps and assigning them into a datastructure
            timestampHandler: function (e) {
                var args = Polymer.dom(e).localTarget.getAttribute('data-args').split(', ');
                var i = args[0];
                if (this.data.timestampsDecision[i] instanceof Array === false) {
                    this.data.timestampsDecision[i] = new Array();
                    this.data.timestampsDecision[i].push({
                        "mode" : args[2]
                    });

                }
                this.data.timestampsDecision[i].push({
                    "answer": args[1]
                    , "time": Date.now()
                });
            }
        });
    </script>
</dom-module>